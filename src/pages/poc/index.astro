---
import PrimaryLayout from "@/layouts/PrimaryLayout.astro";

const poc = [
  {
    name: "One - Props + Callbacks",
    path: "poc-one",
    complexity: "‚≠ê",
    complexityLabel: "Simple",
    performance: 9,
    performanceLabel: "9/10",
    recommendation: "Petites apps, hi√©rarchie peu profonde",
    descriptionText:
      "Pattern le plus simple : le composant parent g√®re l'√©tat avec $state et passe les donn√©es via props aux enfants. Les enfants remontent les changements via callbacks. Id√©al pour les petites applications.",
    useCases: [
      "Vous d√©butez avec Svelte ou les runes",
      "Votre application est petite avec peu de composants",
      "La hi√©rarchie est peu profonde (2-3 niveaux max)",
      "Vous voulez un code simple et explicite",
      "Le flux de donn√©es est unidirectionnel et clair",
    ],
    equivalents: [
      "React : useState + props drilling",
      "Vue : data() + props",
      "Angular : @Input/@Output",
      "POO : Pattern Observer (.NET Events, Java Listeners)",
    ],
    description:
      "Pattern le plus simple : le composant parent g√®re l'√©tat avec $state et passe les donn√©es via props aux enfants. Les enfants remontent les changements via callbacks. Id√©al pour les petites applications. √âquivalent React : useState + props drilling. √âquivalent Vue : data() + props. √âquivalent Angular : @Input/@Output. Pattern classique de la programmation par composants, similaire au pattern Observer en POO (.NET Events, Java Listeners).",
    techDetails:
      "√âtat local dans parent, props descendantes, callbacks remontants",
    pros: "Facile √† comprendre, explicite",
    cons: "Prop drilling, verbeux si profondeur importante",
  },
  {
    name: "Two - Derived Store",
    path: "poc-two",
    complexity: "‚≠ê‚≠ê",
    complexityLabel: "Mod√©r√©",
    performance: 7,
    performanceLabel: "7/10",
    recommendation: "Apps moyennes, √©tat global partag√©",
    descriptionText:
      "Pattern Svelte classique (v3/4) utilisant writable() et derived(). Les composants s'abonnent automatiquement avec la syntaxe $. √âtat global partag√© entre composants sans prop drilling.",
    useCases: [
      "Vous maintenez une app Svelte 3/4 existante",
      "Vous voulez un √©tat global partag√© entre composants distants",
      "Vous √™tes familier avec Redux/Pinia",
      "Vous avez besoin de valeurs d√©riv√©es complexes",
      "‚ö†Ô∏è Note : Pour Svelte 5, pr√©f√©rez le Pattern 3 (Store Runes)",
    ],
    equivalents: [
      "React : Redux (createStore + selectors)",
      "Vue : Pinia stores avec computed",
      "Angular : RxJS BehaviorSubject + combineLatest",
      "POO : Pattern Observer/Publish-Subscribe (.NET IObservable, Java Observable)",
    ],
    description:
      "Pattern Svelte classique (v3/4) utilisant writable() et derived(). Les composants s'abonnent automatiquement avec la syntaxe $. √âtat global partag√© entre composants sans prop drilling. √âquivalent React : Redux (createStore + selectors). √âquivalent Vue : Pinia stores avec computed. √âquivalent Angular : RxJS BehaviorSubject + combineLatest. Pattern Observer avec √©tat r√©actif, similaire au pattern Publish/Subscribe (.NET IObservable, Java Observable).",
    techDetails: "writable, derived, auto-subscription avec $",
    pros: "√âprouv√©, d√©coupl√©, r√©actif",
    cons: "Global scope, legacy dans Svelte 5",
  },
  {
    name: "Three - Store (Runes)",
    path: "poc-three",
    complexity: "‚≠ê‚≠ê‚≠ê",
    complexityLabel: "Mod√©r√©+",
    performance: 10,
    performanceLabel: "10/10",
    recommendation: "‚≠ê RECOMMAND√â pour Svelte 5",
    descriptionText:
      "Store moderne avec les nouvelles runes Svelte 5 ($state, $derived). Encapsule l'√©tat dans une fonction qui retourne des getters r√©actifs. Alternative moderne aux stores classiques.",
    useCases: [
      "Vous voulez un √©tat global partag√©",
      "Plusieurs composants non li√©s doivent acc√©der aux m√™mes donn√©es",
      "Vous avez une seule instance (ex: pr√©f√©rences utilisateur, th√®me, panier)",
      "Vous voulez √©viter le prop drilling",
      "Vous utilisez Svelte 5 et voulez la syntaxe moderne",
    ],
    equivalents: [
      "React : Zustand avec selectors",
      "Vue 3 : Composition API (ref + computed dans composable)",
      "Angular : Signals (Angular 16+)",
      "SolidJS : createSignal (fine-grained reactivity)",
      "POO : Module Pattern + Reactive Extensions (Rx.NET, RxJava)",
    ],
    description:
      "Store moderne avec les nouvelles runes Svelte 5 ($state, $derived). Encapsule l'√©tat dans une fonction qui retourne des getters r√©actifs. Alternative moderne aux stores classiques. √âquivalent React : Zustand avec selectors. √âquivalent Vue 3 : Composition API (ref + computed dans composable). √âquivalent Angular : Signals (Angular 16+). Pattern similaire au Module Pattern avec encapsulation, inspir√© des Reactive Extensions (Rx.NET, RxJava). Fine-grained reactivity comme SolidJS.",
    techDetails: "$state, $derived, fonction factory, getters",
    pros: "Moderne (Svelte 5), performant, scopable",
    cons: "Syntaxe getters n√©cessaire",
  },
  {
    name: "Four - Context API",
    path: "poc-four",
    complexity: "‚≠ê‚≠ê‚≠ê",
    complexityLabel: "Interm√©diaire",
    performance: 9,
    performanceLabel: "9/10",
    recommendation: "UI libraries, th√®mes, sous-arbres",
    descriptionText:
      "Utilise setContext/getContext pour partager l'√©tat dans l'arbre de composants. √âvite le prop drilling en rendant les donn√©es disponibles √† tous les descendants sans passage explicite de props.",
    useCases: [
      "Vous cr√©ez une UI library ou composants r√©utilisables",
      "Vous g√©rez des th√®mes, langues, configurations dans un sous-arbre",
      "Vous voulez √©viter le prop drilling sans √©tat global",
      "L'√©tat est scop√© √† une partie de l'arbre (ex: modal, wizard)",
      "Vous voulez un couplage implicite mais contr√¥l√©",
    ],
    equivalents: [
      "React : Context API (createContext + useContext)",
      "Vue : provide/inject",
      "Angular : Dependency Injection (DI) avec services scoped",
      "Flutter : InheritedWidget",
      "POO : Pattern Dependency Injection (.NET IServiceProvider, Java Spring @Scope)",
    ],
    description:
      "Utilise setContext/getContext pour partager l'√©tat dans l'arbre de composants. √âvite le prop drilling en rendant les donn√©es disponibles √† tous les descendants sans passage explicite de props. √âquivalent React : Context API (createContext + useContext). √âquivalent Vue : provide/inject. √âquivalent Angular : Dependency Injection (DI) avec services scoped. Pattern Dependency Injection classique en POO (.NET IServiceProvider scoped, Java Spring @Scope, InheritedWidget en Flutter).",
    techDetails: "setContext, getContext, contexte implicite",
    pros: "Pas de prop drilling, scop√© √† l'arbre",
    cons: "Implicite, couplage parent-enfant",
  },
  {
    name: "Five - Composable/Hook",
    path: "poc-five",
    complexity: "‚≠ê‚≠ê‚≠ê‚≠ê",
    complexityLabel: "Avanc√©",
    performance: 9,
    performanceLabel: "9/10",
    recommendation: "Logique r√©utilisable, tests unitaires",
    descriptionText:
      "Pattern inspir√© de React hooks et Vue composables. Fonction useFilters() r√©utilisable qui retourne √©tat et m√©thodes. Excellente r√©utilisabilit√© et composition de logiques.",
    useCases: [
      "Vous voulez plusieurs instances ind√©pendantes",
      "Vous privil√©giez l'explicite (props) √† l'implicite (global)",
      "Vous voulez une logique testable en isolation",
      "Vous construisez une biblioth√®que de composants r√©utilisables",
      "Vous avez besoin de plusieurs listes filtr√©es sur la m√™me page",
    ],
    equivalents: [
      "React : Custom Hooks (useState + useEffect)",
      "Vue 3 : Composables (Composition API)",
      "Angular : Standalone functions avec inject()",
      "POO : Strategy Pattern / Composition over Inheritance",
      "Extensions : .NET Extension Methods, Kotlin Functions, Swift Extensions, Rust Traits",
    ],
    description:
      "Pattern inspir√© de React hooks et Vue composables. Fonction useFilters() r√©utilisable qui retourne √©tat et m√©thodes. Excellente r√©utilisabilit√© et composition de logiques. √âquivalent React : Custom Hooks (useState + useEffect). √âquivalent Vue 3 : Composables (Composition API). √âquivalent Angular : Standalone functions avec inject(). Pattern Strategy/Composition over Inheritance en POO, similaire aux mixins (.NET Extension Methods, Kotlin Extension Functions, Swift Extensions, Rust Traits).",
    techDetails: "Fonction composable, retour d'objet r√©actif, pattern hooks",
    pros: "Tr√®s r√©utilisable, testable, composable",
    cons: "N√©cessite passage explicite entre composants",
  },
  {
    name: "Six - Classe .svelte.ts",
    path: "poc-six",
    complexity: "‚≠ê‚≠ê‚≠ê‚≠ê",
    complexityLabel: "Avanc√©",
    performance: 8,
    performanceLabel: "8/10",
    recommendation: "Logique m√©tier complexe, OOP",
    descriptionText:
      "Approche orient√©e objet avec une classe TypeScript utilisant les runes. Encapsulation compl√®te de la logique m√©tier. Permet d'instancier plusieurs gestionnaires ind√©pendants. Tr√®s testable.",
    useCases: [
      "Vous avez une logique m√©tier complexe n√©cessitant encapsulation",
      "Votre √©quipe pr√©f√®re la programmation orient√©e objet",
      "Vous voulez utiliser l'h√©ritage et les interfaces TypeScript",
      "Vous avez besoin de plusieurs instances ind√©pendantes (ex: plusieurs formulaires)",
      "Vous migrez depuis Angular/MobX et voulez une transition douce",
    ],
    equivalents: [
      "React : Classes avec MobX (makeObservable)",
      "Vue : Classes reactives avec vue-class-component",
      "Angular : Services injectables (classes @Injectable)",
      "MVVM : .NET WPF/Xamarin ViewModel, Android ViewModel",
      "POO : Business Logic Layer avec encapsulation (Java Spring @Component)",
    ],
    description:
      "Approche orient√©e objet avec une classe TypeScript utilisant les runes. Encapsulation compl√®te de la logique m√©tier. Permet d'instancier plusieurs gestionnaires ind√©pendants. Tr√®s testable. √âquivalent React : Classes avec MobX (makeObservable). √âquivalent Vue : Classes reactives avec vue-class-component. √âquivalent Angular : Services injectables (classes @Injectable). Pattern OOP classique : ViewModel (MVVM en .NET WPF/Xamarin, Android ViewModel), State Manager (Java Spring @Component), Business Logic Layer avec encapsulation.",
    techDetails:
      "Classe ES6, $state/$derived, m√©thodes publiques, instanciable",
    pros: "OOP, encapsul√©, multiple instances",
    cons: "Plus verbeux, paradigme diff√©rent",
  },
  {
    name: "Seven - Render Props/Slots",
    path: "poc-seven",
    complexity: "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
    complexityLabel: "Expert",
    performance: 10,
    performanceLabel: "10/10",
    recommendation: "Composants r√©utilisables, libraries",
    descriptionText:
      "Pattern avanc√© utilisant les Snippets Svelte 5 pour l'inversion de contr√¥le. Le composant FilterProvider expose l'√©tat via un slot avec props. Maximum de flexibilit√© et d√©couplage.",
    useCases: [
      "Vous cr√©ez une biblioth√®que de composants hautement r√©utilisables",
      "Vous voulez un d√©couplage total entre logique et rendu",
      "Vous avez besoin de maximum de flexibilit√© pour l'utilisateur du composant",
      "Vous construisez des headless components (logique sans UI impos√©e)",
      "Vous √™tes √† l'aise avec des patterns avanc√©s (IoC, Strategy)",
    ],
    equivalents: [
      "React : Render Props pattern ou Children as Function",
      "Vue : Scoped Slots (v-slot avec props)",
      "Angular : ng-template avec context",
      "POO : Inversion of Control (IoC), Template Method Pattern",
      "Callbacks : .NET Delegates/Func<T>, Java Functional Interfaces, Strategy Pattern",
    ],
    description:
      "Pattern avanc√© utilisant les Snippets Svelte 5 pour l'inversion de contr√¥le. Le composant FilterProvider expose l'√©tat via un slot avec props. Maximum de flexibilit√© et d√©couplage. √âquivalent React : Render Props pattern ou Children as Function. √âquivalent Vue : Scoped Slots (v-slot avec props). √âquivalent Angular : ng-template avec context. Pattern Inversion of Control (IoC) en POO, similaire au Template Method Pattern (.NET Delegates/Func<T>, Java Functional Interfaces, Strategy Pattern avec injection de comportement).",
    techDetails: "Snippet, render props, inversion de contr√¥le, slot props",
    pros: "Maximum de flexibilit√©, d√©couplage total",
    cons: "Syntaxe complexe, courbe d'apprentissage",
  },
];
---

<PrimaryLayout>
  <div class="place-self-center">
    <div class="flex flex-col mx-auto mb-20 p-4 max-w-6xl">
      <h1 class="mb-6 font-bold text-4xl">
        Patterns de Gestion d'√âtat - Svelte 5
      </h1>

      <div class="bg-blue-50 dark:bg-blue-900/20 mb-8 p-4 rounded-lg">
        <h2 class="mb-2 font-semibold text-xl">üéØ 7 Approches Compar√©es</h2>
        <p class="text-gray-700 dark:text-gray-300 text-sm">
          D√©monstration de 7 patterns pour g√©rer l'√©tat et le filtrage de
          donn√©es, du plus simple au plus avanc√©. Chaque impl√©mentation r√©sout
          le m√™me probl√®me : filtrer une liste d'items par cat√©gorie.
        </p>
      </div>

      <!-- Tableau comparatif -->
      <div
        class="bg-white dark:bg-gray-900 shadow-lg mb-8 p-6 border dark:border-gray-700 rounded-xl overflow-x-auto"
      >
        <h2 class="mb-4 font-bold text-2xl">üìä Tableau Comparatif</h2>
        <table class="w-full text-sm">
          <thead>
            <tr class="dark:border-gray-700 border-b-2">
              <th class="px-4 py-2 font-bold text-left">Pattern</th>
              <th class="px-4 py-2 font-bold text-center">Complexit√©</th>
              <th class="px-4 py-2 font-bold text-center">Performance</th>
              <th class="px-4 py-2 font-bold text-left">Recommand√© pour</th>
              <th class="px-4 py-2 font-bold text-left">Avantages</th>
              <th class="px-4 py-2 font-bold text-left">Inconv√©nients</th>
            </tr>
          </thead>
          <tbody>
            {
              poc.map((item, index) => (
                <tr
                  class={`border-b dark:border-gray-800 ${index % 2 === 0 ? "bg-gray-50 dark:bg-gray-800/50" : ""}`}
                >
                  <td class="px-4 py-3">
                    <a
                      href={`/poc/${item.path}`}
                      class="font-semibold text-blue-600 dark:text-blue-400 hover:underline"
                    >
                      {item.name}
                    </a>
                  </td>
                  <td class="px-4 py-3 text-center whitespace-nowrap">
                    <span class="inline-block">{item.complexity}</span>
                    <br />
                    <span class="text-gray-500 dark:text-gray-400 text-xs">
                      {item.complexityLabel}
                    </span>
                  </td>
                  <td class="px-4 py-3 text-center whitespace-nowrap">
                    <span
                      class={`inline-block text-2xl font-bold ${
                        item.performance >= 9
                          ? "text-green-600 dark:text-green-400"
                          : item.performance >= 8
                            ? "text-blue-600 dark:text-blue-400"
                            : "text-yellow-600 dark:text-yellow-400"
                      }`}
                    >
                      {item.performance}
                    </span>
                    <br />
                    <span class="text-gray-500 dark:text-gray-400 text-xs">
                      {item.performanceLabel}
                    </span>
                  </td>
                  <td class="px-4 py-3">
                    <span class="bg-blue-50 dark:bg-blue-900/30 px-2 py-1 rounded font-medium text-blue-700 dark:text-blue-300 text-xs">
                      {item.recommendation}
                    </span>
                  </td>
                  <td class="px-4 py-3 text-green-700 dark:text-green-400 text-xs">
                    ‚úì {item.pros}
                  </td>
                  <td class="px-4 py-3 text-orange-700 dark:text-orange-400 text-xs">
                    ‚ö† {item.cons}
                  </td>
                </tr>
              ))
            }
          </tbody>
        </table>
      </div>

      <!-- Liste des patterns avec descriptions d√©taill√©es -->
      <h2 class="mb-4 font-bold text-2xl">üîç D√©tails des Patterns</h2>
      <div class="space-y-4">
        {
          poc.map((item) => (
            <a
              href={`/poc/${item.path}`}
              class="block hover:shadow-lg p-5 border hover:border-blue-400 dark:hover:border-blue-600 rounded-xl transition-all"
            >
              <div class="flex justify-between items-start mb-3">
                <h3 class="font-bold text-blue-600 dark:text-blue-400 text-xl hover:underline">
                  {item.name}
                </h3>
                <div class="flex gap-2 ml-4">
                  <span class="bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full font-medium text-xs whitespace-nowrap">
                    {item.complexity} {item.complexityLabel}
                  </span>
                  <span
                    class={`px-3 py-1 rounded-full font-bold text-xs whitespace-nowrap ${
                      item.performance >= 9
                        ? "bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"
                        : item.performance >= 8
                          ? "bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300"
                          : "bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300"
                    }`}
                  >
                    {item.performanceLabel}
                  </span>
                </div>
              </div>
              <div class="bg-blue-50 dark:bg-blue-900/20 mb-3 px-3 py-2 rounded-lg">
                <span class="font-semibold text-blue-900 dark:text-blue-200 text-xs">
                  üí° Recommand√© pour : {item.recommendation}
                </span>
              </div>
              
              {/* Description et √©quivalents techniques en deux colonnes */}
              <div class="gap-4 grid grid-cols-2 mb-3">
                <div class="space-y-3">
                  <p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
                    {item.descriptionText}
                  </p>
                  <div class="bg-purple-50 dark:bg-purple-900/20 p-3 border border-purple-200 dark:border-purple-800 rounded-lg">
                    <h4 class="mb-2 font-semibold text-purple-900 dark:text-purple-100 text-xs">
                      ‚úÖ Utilisez ce pattern si :
                    </h4>
                    <ul class="space-y-1 text-purple-800 dark:text-purple-200 text-xs">
                      {item.useCases.map((useCase: string) => (
                        <li class="flex items-start">
                          <span class="mr-1.5 text-purple-500">‚úì</span>
                          <span>{useCase}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg">
                  <h4 class="mb-2 font-semibold text-gray-900 dark:text-gray-100 text-xs">
                    üîó √âquivalents techniques
                  </h4>
                  <ul class="space-y-1 text-gray-700 dark:text-gray-300 text-xs">
                    {item.equivalents.map((equiv: string) => (
                      <li class="flex items-start">
                        <span class="mr-1.5 text-blue-500">‚ñ∏</span>
                        <span>{equiv}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>

              {/* Avantages et inconv√©nients */}
              <div class="gap-4 grid grid-cols-2 mt-3">
                <div class="bg-green-50 dark:bg-green-900/20 p-2 rounded">
                  <span class="text-green-700 dark:text-green-400 text-xs">
                    ‚úì {item.pros}
                  </span>
                </div>
                <div class="bg-orange-50 dark:bg-orange-900/20 p-2 rounded">
                  <span class="text-orange-700 dark:text-orange-400 text-xs">
                    ‚ö† {item.cons}
                  </span>
                </div>
              </div>
            </a>
          ))
        }
      </div>

      <div
        class="bg-linear-to-r from-purple-50 dark:from-purple-900/20 to-blue-50 dark:to-blue-900/20 mt-8 p-6 border border-purple-200 dark:border-purple-800 rounded-xl"
      >
        <h3 class="mb-3 font-bold text-purple-900 dark:text-purple-100 text-xl">
          üìñ Documentation Compl√®te
        </h3>
        <p class="mb-3 text-gray-700 dark:text-gray-300 text-sm">
          Pour une analyse d√©taill√©e avec tableaux comparatifs,
          avantages/inconv√©nients et recommandations par cas d'usage :
        </p>
        <a
          href="/poc/pattern"
          class="inline-block bg-purple-600 hover:bg-purple-700 dark:bg-purple-500 dark:hover:bg-purple-600 px-4 py-2 rounded-lg font-semibold text-white text-sm transition-colors"
        >
          üìÑ Voir PATTERNS_COMPARISON.md
        </a>
      </div>
    </div>
  </div>
</PrimaryLayout>
